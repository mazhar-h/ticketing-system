<div class="payment-settings">
  <h2>Payment Settings</h2>

  <!-- Payout Schedule Section -->
  <div class="payout-schedule-section">
    <h3>Set Payout Schedule</h3>
    <form (ngSubmit)="updatePayoutSchedule()">
      <!-- Payout Interval Dropdown -->
      <label for="payoutInterval">Payout Interval:</label>
      <select
        id="payoutInterval"
        [(ngModel)]="payoutInterval"
        name="payoutInterval"
        required
      >
        <option value="MANUAL">Manual</option>
        <option value="DAILY">Daily</option>
        <option value="WEEKLY">Weekly</option>
        <option value="MONTHLY">Monthly</option>
      </select>

      <!-- Weekly Anchor Dropdown (shown only if 'Weekly' is selected) -->
      <div *ngIf="payoutInterval === 'WEEKLY'">
        <label for="weeklyAnchor">Payout Day:</label>
        <select
          id="weeklyAnchor"
          [(ngModel)]="weeklyAnchor"
          name="weeklyAnchor"
          required
        >
          <option value="MONDAY">Monday</option>
          <option value="TUESDAY">Tuesday</option>
          <option value="WEDNESDAY">Wednesday</option>
          <option value="THURSDAY">Thursday</option>
          <option value="FRIDAY">Friday</option>
          <option value="SATURDAY">Saturday</option>
          <option value="SUNDAY">Sunday</option>
        </select>
      </div>

      <!-- Monthly Anchor Input (shown only if 'Monthly' is selected) -->
      <div *ngIf="payoutInterval === 'MONTHLY'">
        <label for="monthlyAnchor">Payout Day of the Month:</label>
        <input
          type="number"
          id="monthlyAnchor"
          [(ngModel)]="monthlyAnchor"
          name="monthlyAnchor"
          min="1"
          max="31"
          required
        />
      </div>

      <button type="submit">Update Payout Schedule</button>
    </form>
  </div>

  <!-- Bank Account Section -->
  <div *ngIf="bankAccount && !editingBank && !addingBank">
    <h3>Bank Account Information</h3>
    <p><strong>Bank Name:</strong> {{ bankAccount.bankName }}</p>
    <p><strong>Last 4 Digits:</strong> {{ bankAccount.last4 }}</p>
    <p><strong>Status:</strong> {{ bankAccount.status }}</p>
    <button (click)="openBankForm(true)">Edit Bank Account</button>
    <button (click)="removeExternalAccount(bankAccount.id)">
      Remove Bank Account
    </button>
  </div>

  <!-- Card Section -->
  <div *ngIf="card && !editingCard && !addingCard">
    <h3>Debit Card Information</h3>
    <p><strong>Card Brand:</strong> {{ card.brand }}</p>
    <p><strong>Last 4 Digits:</strong> {{ card.last4 }}</p>
    <p><strong>Expiration:</strong> {{ card.expMonth }}/{{ card.expYear }}</p>
    <button (click)="openCardForm(true)">Edit Card</button>
    <button (click)="removeExternalAccount(card.id)">Remove Card</button>
  </div>

  <!-- Show Add Option for Card if Only Bank Account Exists -->
  <div *ngIf="bankAccount && !card && !editingCard && !addingCard">
    <h3>Add Debit Card</h3>
    <button (click)="openCardForm(false)">Add Card</button>
  </div>

  <!-- Show Add Option for Bank if Only Card Exists -->
  <div *ngIf="!bankAccount && card && !editingBank && !addingBank">
    <h3>Add Bank Account</h3>
    <button (click)="openBankForm(false)">Add Bank Account</button>
  </div>

  <!-- Show Add Options if No External Accounts Exist -->
  <div
    *ngIf="
      !bankAccount &&
      !card &&
      !addingBank &&
      !addingCard &&
      !editingBank &&
      !editingCard
    "
  >
    <h3>Add Payment Method</h3>
    <label>
      <input
        type="radio"
        name="payoutMethod"
        value="bank"
        [(ngModel)]="selectedPayoutMethod"
        (change)="openBankForm(false)"
      />
      Add Bank Account
    </label>
    <label>
      <input
        type="radio"
        name="payoutMethod"
        value="card"
        [(ngModel)]="selectedPayoutMethod"
        (change)="openCardForm(false)"
      />
      Add Debit Card
    </label>
  </div>

  <!-- Edit Bank Account Form -->
  <div [hidden]="!editingBank">
    <h3>Edit Bank Account Information</h3>
    <form (ngSubmit)="submitBankAccountForm()">
      <label>Routing Number</label>
      <input
        type="text"
        [(ngModel)]="routingNumber"
        name="routingNumber"
        required
      />

      <label>Account Number</label>
      <input
        type="text"
        [(ngModel)]="accountNumber"
        name="accountNumber"
        required
      />

      <label>Account Holder Name</label>
      <input
        type="text"
        [(ngModel)]="accountHolderName"
        name="accountHolderName"
        required
      />

      <label>
        <input
          type="checkbox"
          [(ngModel)]="isBusinessAccount"
          name="isBusinessAccount"
        />
        Business Account
      </label>
      <button type="submit" [disabled]="!stripeLoaded">
        Save Bank Account
      </button>
      <button type="button" (click)="cancelEditAdd('bank')">Cancel</button>
    </form>
  </div>

  <!-- Edit Debit Card Form -->
  <div [hidden]="!editingCard">
    <h3>Edit Debit Card Information</h3>
    <form (ngSubmit)="submitCardForm()">
      <div id="card-element-edit"></div>
      <button type="submit" [disabled]="!stripeLoaded">Save Card</button>
      <button type="button" (click)="cancelEditAdd('card')">Cancel</button>
    </form>
  </div>

  <div [hidden]="!addingBank">
    <h3>Add Bank Account Information (U.S. Only)</h3>
    <form (ngSubmit)="submitBankAccountForm()">
      <label>Routing Number</label>
      <input
        type="text"
        [(ngModel)]="routingNumber"
        name="routingNumber"
        required
      />

      <label>Account Number</label>
      <input
        type="text"
        [(ngModel)]="accountNumber"
        name="accountNumber"
        required
      />

      <label>Account Holder Name</label>
      <input
        type="text"
        [(ngModel)]="accountHolderName"
        name="accountHolderName"
        required
      />

      <label>
        <input
          type="checkbox"
          [(ngModel)]="isBusinessAccount"
          name="isBusinessAccount"
        />
        Business Account
      </label>

      <button type="submit" [disabled]="!stripeLoaded">
        Save Bank Account
      </button>
      <button type="button" (click)="cancelEditAdd('bank')">Cancel</button>
    </form>
  </div>

  <div [hidden]="!addingCard">
    <h3>Add Debit Card Information</h3>
    <form (ngSubmit)="submitCardForm()">
      <div id="card-element-add"></div>
      <button type="submit" [disabled]="!stripeLoaded">Save Debit Card</button>
      <button type="button" (click)="cancelEditAdd('card')">Cancel</button>
    </form>
  </div>
</div>
